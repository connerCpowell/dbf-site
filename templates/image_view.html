<!DOCTYPE html>
<html>

<head>
    <title>{{ filename }}</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>

<body class="image-view">

    <h2>{{ filename }}</h2>

    <div class="image-container">
        <img id="photo" src="{{ url_for('static', filename='pics/' + filepath) }}" alt="Image">
    </div>

    <div class="controls">
        <button onclick="rotate(-90)">Rotate</button>

        {% if prev_img %}
        <button onclick="goTo('{{ prev_img }}')">Previous</button>
        {% endif %}

        {% if next_img %}
        <button onclick="goTo('{{ next_img }}')">Next</button>
        {% endif %}
    </div>

    <div class="zoom-controls">
        <button onclick="zoomIn()">Zoom +</button>
        <button onclick="zoomOut()">Zoom -</button>
    </div>

    <script>
        let rotation = 0;
        let zoom = 1;

        function rotate(amount) {
            rotation += amount;
            updateTransform();
        }

        function zoomIn() {
            zoom += 0.2;
            updateTransform();
        }

        function zoomOut() {
            zoom = Math.max(0.4, zoom - 0.2);
            updateTransform();
        }

        function updateTransform() {
            document.getElementById("photo").style.transform =
                `scale(${zoom}) rotate(${rotation}deg)`;
        }

        function goTo(img) {
            window.location.href = "/view/" + img;
        }

        // Pinch zoom for mobile
        let img = document.getElementById("photo");
        let startDist = 0;

        img.addEventListener("touchstart", e => {
            if (e.touches.length === 2) {
                startDist = getDistance(e.touches[0], e.touches[1]);
            }
        });

        img.addEventListener("touchmove", e => {
            if (e.touches.length === 2) {
                let newDist = getDistance(e.touches[0], e.touches[1]);
                let scaleChange = newDist / startDist;

                zoom = Math.min(5, Math.max(0.4, zoom * scaleChange));
                startDist = newDist;
                updateTransform();
            }
        });

        function getDistance(t1, t2) {
            return Math.sqrt(
                Math.pow(t1.pageX - t2.pageX, 2) +
                Math.pow(t1.pageY - t2.pageY, 2)
            );
        }
    </script>

</body>

</html>